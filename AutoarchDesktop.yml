# file: AutoarchDesktop.yml
# Playbook to setup an xorg desktop

- hosts: arch_desktops
  user: root
  vars:
    aur_sync: "sudo -u builder aur sync -c --noview --noconfirm -d custom"
  tasks:
    ## preparation
    - name: create .ssh directory
      file:
        state: directory
        path: "/home/{{ admin_user }}/.ssh"
        owner: "{{ admin_user }}"
        group: "{{ admin_user }}"
        mode: '0700'

    - include_role:
        name: conf_user_git

    - include_role:
        name: archpkg_local_aurutils


    - name: update package cache and upgrade system (pacman -Syu)
      pacman:
        update_cache: yes
        upgrade: yes

    # ## drivers
    - name: install video drivers
      pacman:
        name:
          - "{{ desktop_video_driver }}"
          - mesa
          - xf86-video-vesa
        state: present
        extra_args: "--noconfirm"

    - name: install PulseAudio
      pacman:
        name:
          - "extra/pulseaudio"
          - pulsemixer
        state: present
        extra_args: "--noconfirm"

    ## software
    - name: install xorg and graphical environment software
      pacman:
        name:
          - xorg
          - xorg-xinit
          - "i3-gaps"
          - termite
          - conky
          - firefox
          - keepass
          - feh
          - mpd
          - vlc
          - nitrogen
        state: present
        extra_args: "--noconfirm"

    # special software form the AUR
    - name: install AUR software
      block:
        - command: "{{ aur_sync }} polybar"
        - command: "{{ aur_sync }} picom-tryone-git"
        - pacman: name="custom/polybar"
        - pacman: name="custom/picom-tryone-git"

    ## input configuration
    - include_role:
        name: input_dev_conf
